<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FairDeal - Decentralized Escrow</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
        Cantarell, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px 20px;
      border-radius: 8px;
      margin-bottom: 40px;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    section {
      background: white;
      padding: 30px;
      margin-bottom: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.8rem;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    section h3 {
      color: #764ba2;
      margin-top: 20px;
      margin-bottom: 10px;
      font-size: 1.3rem;
    }

    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: "Courier New", monospace;
      color: #d63384;
    }

    pre {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 10px 0;
      font-size: 0.9rem;
    }

    ul, ol {
      margin-left: 20px;
      margin-bottom: 10px;
    }

    li {
      margin-bottom: 8px;
    }

    .flow-diagram {
      background: #f9f9f9;
      padding: 20px;
      border-left: 4px solid #667eea;
      margin: 15px 0;
      border-radius: 4px;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .feature-card {
      background: #f5f7ff;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .feature-card h4 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
    }

    .success {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }

    th {
      background: #f5f5f5;
      font-weight: bold;
    }

    .command {
      background: #f4f4f4;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-family: "Courier New", monospace;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üöÄ FairDeal - Decentralized Freelancing Escrow</h1>
      <p>A Stellar Soroban-powered escrow platform for secure freelance transactions</p>
    </header>

    <!-- Overview Section -->
    <section>
      <h2>üìã Project Overview</h2>
      <p>
        FairDeal is a decentralized escrow platform built on Stellar Soroban that enables secure
        freelancing transactions without intermediaries. Funds are locked in a smart contract until
        both parties agree, with cryptographic verification of work submission.
      </p>

      <h3>Key Features</h3>
      <div class="feature-grid">
        <div class="feature-card">
          <h4>üîê Smart Contract Escrow</h4>
          <p>Funds locked in Soroban smart contracts, immutable and secure</p>
        </div>
        <div class="feature-card">
          <h4>üé® Watermarked Previews</h4>
          <p>Clients review watermarked work before approval, original encrypted</p>
        </div>
        <div class="feature-card">
          <h4>üì¶ IPFS Storage</h4>
          <p>Decentralized file storage via web3.storage for all submissions</p>
        </div>
        <div class="feature-card">
          <h4>üîë Wallet Auth</h4>
          <p>No passwords - authenticate with Stellar wallet (Freighter)</p>
        </div>
        <div class="feature-card">
          <h4>‚è∞ Auto Refund</h4>
          <p>Anyone can trigger refund after deadline if work not approved</p>
        </div>
        <div class="feature-card">
          <h4>üéØ AES Encryption</h4>
          <p>Original files encrypted before IPFS upload for privacy</p>
        </div>
      </div>
    </section>

    <!-- Architecture Section -->
    <section>
      <h2>üèóÔ∏è Architecture</h2>

      <h3>System Components</h3>
      <div class="flow-diagram">
        <strong>Frontend (React)</strong> ‚Üí Wallet Connect ‚Üí User Interface<br/>
        ‚Üì<br/>
        <strong>Backend (Node.js + Express)</strong> ‚Üí File Processing ‚Üí IPFS Upload<br/>
        ‚Üì<br/>
        <strong>Blockchain (Soroban)</strong> ‚Üí Job State Management ‚Üí Fund Locking<br/>
        ‚Üì<br/>
        <strong>Decentralized Storage</strong> ‚Üí IPFS (web3.storage) ‚Üí Watermarked + Encrypted Files
      </div>

      <h3>Technology Stack</h3>
      <table>
        <tr>
          <th>Layer</th>
          <th>Technology</th>
          <th>Purpose</th>
        </tr>
        <tr>
          <td><strong>Smart Contract</strong></td>
          <td>Rust + Soroban SDK</td>
          <td>Job state, fund locking, approval logic</td>
        </tr>
        <tr>
          <td><strong>Backend</strong></td>
          <td>Node.js + Express</td>
          <td>File processing, encryption, IPFS upload</td>
        </tr>
        <tr>
          <td><strong>Frontend</strong></td>
          <td>React + React Router</td>
          <td>User interface, wallet connection</td>
        </tr>
        <tr>
          <td><strong>Storage</strong></td>
          <td>IPFS (web3.storage)</td>
          <td>Decentralized file hosting</td>
        </tr>
        <tr>
          <td><strong>Authentication</strong></td>
          <td>Freighter / Stellar Wallet</td>
          <td>Wallet-based authentication</td>
        </tr>
      </table>
    </section>

    <!-- Flow Diagrams -->
    <section>
      <h2>üîÑ User Flows</h2>

      <h3>1. Job Creation Flow</h3>
      <div class="flow-diagram">
        <strong>Client</strong><br/>
        ‚Üì<br/>
        1. Connect Wallet (Freighter)<br/>
        2. Create Job with freelancer address, amount, deadline, description<br/>
        3. Call smart contract: <code>create_job()</code><br/>
        4. Deposit funds: <code>deposit_funds()</code><br/>
        5. Funds locked in escrow ‚úÖ
      </div>

      <h3>2. Work Submission Flow</h3>
      <div class="flow-diagram">
        <strong>Freelancer</strong><br/>
        ‚Üì<br/>
        1. View job details<br/>
        2. Upload work file to backend<br/>
        3. Backend:<br/>
           - Encrypts original file (AES-256)<br/>
           - Creates watermarked preview<br/>
           - Uploads both to IPFS<br/>
        4. Backend calls smart contract: <code>mark_submitted()</code><br/>
        5. Preview CID provided to client ‚úÖ
      </div>

      <h3>3. Approval Flow</h3>
      <div class="flow-diagram">
        <strong>Client</strong><br/>
        ‚Üì<br/>
        1. Review watermarked preview from IPFS<br/>
        2. If approved:<br/>
           - Call smart contract: <code>approve_job()</code><br/>
           - Funds transferred to freelancer<br/>
           - Backend reveals original CID + decryption key<br/>
        ‚úÖ Freelancer can now decrypt original file
      </div>

      <h3>4. Rejection Flow</h3>
      <div class="flow-diagram">
        <strong>Client</strong><br/>
        ‚Üì<br/>
        1. Review watermarked preview<br/>
        2. If not satisfied:<br/>
           - Call smart contract: <code>reject_job()</code><br/>
           - Funds refunded to client<br/>
           - Backend never reveals original<br/>
        ‚úÖ Freelancer's original work stays encrypted
      </div>

      <h3>5. Auto-Refund Flow</h3>
      <div class="flow-diagram">
        <strong>Anyone (Decentralized)</strong><br/>
        ‚Üì<br/>
        1. If deadline passes with no approval<br/>
        2. Call smart contract: <code>refund_after_deadline()</code><br/>
        3. Funds refunded to client<br/>
        ‚úÖ Safe fallback mechanism
      </div>
    </section>

    <!-- Smart Contract Section -->
    <section>
      <h2>üìú Smart Contract Details</h2>

      <h3>Job Struct</h3>
      <pre>#[derive(Clone)]
#[contracttype]
pub struct Job {
    pub id: u64,
    pub client: Address,
    pub freelancer: Address,
    pub amount: i128,
    pub deadline: u64,
    pub description: String,
    pub state: u32, // 0=Created, 1=Submitted, 2=Approved, 3=Rejected, 4=Refunded
    pub created_at: u64,
    pub submitted_at: u64,
    pub completed_at: u64,
}</pre>

      <h3>Core Functions</h3>
      <table>
        <tr>
          <th>Function</th>
          <th>Called By</th>
          <th>Action</th>
        </tr>
        <tr>
          <td><code>create_job()</code></td>
          <td>Client</td>
          <td>Create new job with details</td>
        </tr>
        <tr>
          <td><code>deposit_funds()</code></td>
          <td>Client</td>
          <td>Lock funds in escrow</td>
        </tr>
        <tr>
          <td><code>mark_submitted()</code></td>
          <td>Backend/Freelancer</td>
          <td>Mark job as submitted</td>
        </tr>
        <tr>
          <td><code>approve_job()</code></td>
          <td>Client</td>
          <td>Approve and release funds</td>
        </tr>
        <tr>
          <td><code>reject_job()</code></td>
          <td>Client</td>
          <td>Reject and refund</td>
        </tr>
        <tr>
          <td><code>refund_after_deadline()</code></td>
          <td>Anyone</td>
          <td>Refund if deadline passed</td>
        </tr>
      </table>

      <h3>State Transitions</h3>
      <pre>Created (0)
   ‚Üì
   ‚îú‚îÄ‚Üí Submitted (1)
   ‚îÇ    ‚îú‚îÄ‚Üí Approved (2) ‚úÖ ‚Üí Funds Released
   ‚îÇ    ‚îî‚îÄ‚Üí Rejected (3) ‚ùå ‚Üí Funds Refunded
   ‚îî‚îÄ‚Üí Refunded (4) ‚è∞ ‚Üí Deadline passed
</pre>
    </section>

    <!-- Backend Section -->
    <section>
      <h2>‚öôÔ∏è Backend API</h2>

      <h3>Core Endpoints</h3>

      <h4>POST /api/jobs/submit-work</h4>
      <p>Submit work for a job</p>
      <pre>Request:
- jobId (number)
- freelancerAddress (string)
- file (binary)

Response:
{
  "success": true,
  "jobId": "123",
  "previewCID": "QmXxxx...",
  "originalCID": "QmYyyy..." (don't reveal yet)
}</pre>

      <h4>GET /api/jobs/:jobId/preview</h4>
      <p>Get preview CID and metadata</p>
      <pre>Response:
{
  "jobId": "123",
  "previewCID": "QmXxxx...",
  "previewURL": "https://w3s.link/ipfs/QmXxxx...",
  "fileName": "design.psd",
  "submittedAt": "2026-01-24T10:30:00Z"
}</pre>

      <h4>POST /api/jobs/:jobId/approve</h4>
      <p>Approve job (called after smart contract approves)</p>
      <pre>Response:
{
  "originalCID": "QmYyyy...",
  "originalURL": "https://w3s.link/ipfs/QmYyyy...",
  "decryptionKey": "hex_string_here",
  "decryptionIV": "hex_string_here"
}</pre>

      <h4>POST /api/jobs/:jobId/reject</h4>
      <p>Reject job (original never revealed)</p>

      <h4>GET /api/jobs/:jobId/status</h4>
      <p>Get job submission status</p>

      <h3>Backend Processing Pipeline</h3>
      <div class="flow-diagram">
        File Upload<br/>
        ‚Üì<br/>
        ‚Üí Generate AES-256 key + IV<br/>
        ‚Üí Encrypt original file<br/>
        ‚Üí Create watermarked preview (JIMP)<br/>
        ‚Üí Upload encrypted original to IPFS<br/>
        ‚Üí Upload watermarked preview to IPFS<br/>
        ‚Üí Store keys in memory/DB<br/>
        ‚Üí Return preview CID to client<br/>
        ‚Üì<br/>
        On Approval:<br/>
        ‚Üí Reveal original CID<br/>
        ‚Üí Provide decryption key + IV
      </div>
    </section>

    <!-- Frontend Section -->
    <section>
      <h2>üé® Frontend Components</h2>

      <h3>Pages</h3>
      <ul>
        <li><strong>WalletConnect</strong> - Authenticate with Freighter wallet, select role</li>
        <li><strong>Dashboard</strong> - View all jobs, filter by status</li>
        <li><strong>CreateJob</strong> - Create new job with details</li>
        <li><strong>JobDetail</strong> - View job details, approve/reject, submit work</li>
        <li><strong>SubmitWork</strong> - Upload work file</li>
      </ul>

      <h3>Key Libraries</h3>
      <ul>
        <li><code>@stellar/freighter-api</code> - Wallet integration</li>
        <li><code>react-router-dom</code> - Navigation</li>
        <li><code>axios</code> - API calls</li>
        <li><code>stellar-sdk</code> - Soroban contract interaction</li>
      </ul>
    </section>

    <!-- Setup Section -->
    <section>
      <h2>üöÄ Quick Start Setup</h2>

      <h3>Prerequisites</h3>
      <ul>
        <li>Node.js 16+ and npm</li>
        <li>Rust 1.70+ (for contract compilation)</li>
        <li>Freighter wallet extension</li>
        <li>web3.storage API key (free tier available)</li>
      </ul>

      <h3>Installation Steps</h3>

      <h4>1. Clone & Setup Project Structure</h4>
      <div class="command">
git clone &lt;repo&gt;<br/>
cd FairDeal<br/>
      </div>

      <h4>2. Setup Backend</h4>
      <div class="command">
cd backend<br/>
npm install<br/>
cp .env.example .env<br/>
# Edit .env and add your WEB3_STORAGE_TOKEN<br/>
npm start
      </div>
      <p>Backend runs on <code>http://localhost:5000</code></p>

      <h4>3. Setup Frontend</h4>
      <div class="command">
cd frontend<br/>
npm install<br/>
npm start
      </div>
      <p>Frontend opens on <code>http://localhost:3000</code></p>

      <h4>4. Compile & Deploy Smart Contract</h4>
      <div class="command">
cd contract<br/>
cargo build --target wasm32-unknown-unknown --release
      </div>
      <p>
        Then deploy to Stellar testnet using Soroban CLI:<br/>
        <code>soroban contract deploy --network testnet --source &lt;account&gt; ...</code>
      </p>

      <div class="success">
        <strong>‚úÖ Setup Complete!</strong> You now have:
        <ul>
          <li>Smart contract for fund locking</li>
          <li>Backend for file processing & IPFS</li>
          <li>Frontend for user interaction</li>
        </ul>
      </div>
    </section>

    <!-- Environment Variables -->
    <section>
      <h2>‚öôÔ∏è Environment Variables</h2>

      <h3>Backend (.env)</h3>
      <pre>PORT=5000
WEB3_STORAGE_TOKEN=your_api_key_here
STELLAR_NETWORK=testnet
SOROBAN_RPC_URL=https://soroban-testnet.stellar.org
STELLAR_CONTRACT_ID=your_contract_id_here</pre>

      <h3>Getting web3.storage Token</h3>
      <ol>
        <li>Go to <code>https://web3.storage</code></li>
        <li>Sign up with GitHub</li>
        <li>Go to Account ‚Üí API Tokens</li>
        <li>Create new token and copy to .env</li>
      </ol>
    </section>

    <!-- Testing Section -->
    <section>
      <h2>üß™ Testing Workflow</h2>

      <h3>Manual Testing Steps</h3>
      <ol>
        <li>
          <strong>Create Job</strong>
          <ul>
            <li>Connect as Client</li>
            <li>Create job with freelancer address</li>
            <li>Deposit funds (simulated)</li>
          </ul>
        </li>
        <li>
          <strong>Submit Work</strong>
          <ul>
            <li>Connect as Freelancer</li>
            <li>Upload work file</li>
            <li>Backend encrypts & uploads to IPFS</li>
          </ul>
        </li>
        <li>
          <strong>Review & Approve</strong>
          <ul>
            <li>Connect as Client</li>
            <li>View watermarked preview from IPFS</li>
            <li>Click Approve</li>
            <li>Original CID + decryption key revealed</li>
          </ul>
        </li>
      </ol>

      <h3>Contract Test Cases</h3>
      <pre>‚úì create_job() with valid parameters
‚úì create_job() fails with invalid amount
‚úì create_job() fails with past deadline
‚úì deposit_funds() locks funds
‚úì mark_submitted() transitions state
‚úì approve_job() releases funds
‚úì reject_job() refunds client
‚úì refund_after_deadline() on expiry</pre>
    </section>

    <!-- Hackathon Tips -->
    <section>
      <h2>üí° Hackathon Tips</h2>

      <h3>Focus Areas</h3>
      <ul>
        <li><strong>Demo Flow:</strong> Create ‚Üí Submit ‚Üí Approve workflow</li>
        <li><strong>File Handling:</strong> Show watermarked preview working</li>
        <li><strong>Contract Interaction:</strong> Demonstrate job state transitions</li>
        <li><strong>Decryption:</strong> Show how original is revealed on approval</li>
      </ul>

      <h3>Quick Wins for Demo</h3>
      <ul>
        <li>Pre-populate a test job</li>
        <li>Use mock wallet addresses for quick testing</li>
        <li>Have IPFS links ready to share in presentation</li>
        <li>Record a demo flow beforehand</li>
      </ul>

      <h3>What Can be Simplified</h3>
      <ul>
        <li>Token contract calls (simulated in MVP)</li>
        <li>Full Soroban deployment (use testnet)</li>
        <li>Complex watermarking (JIMP watermark is sufficient)</li>
        <li>In-memory storage is fine for MVP</li>
      </ul>

      <div class="warning">
        <strong>‚ö†Ô∏è MVP Limitations:</strong>
        <ul>
          <li>No persistent database (use memory)</li>
          <li>No user authentication system (wallet-based only)</li>
          <li>No payment integration (simulated)</li>
          <li>No complex file validation</li>
        </ul>
      </div>
    </section>

    <!-- Deployment -->
    <section>
      <h2>üåê Deployment Guide</h2>

      <h3>Smart Contract Deployment</h3>
      <ol>
        <li>
          Compile contract:
          <div class="command">cd contract && cargo build --target wasm32-unknown-unknown --release</div>
        </li>
        <li>
          Get contract binary at: <code>contract/target/wasm32-unknown-unknown/release/fairdeal_escrow.wasm</code>
        </li>
        <li>
          Deploy to testnet:
          <div class="command">soroban contract deploy --network testnet --source &lt;account&gt; --wasm &lt;path-to-wasm&gt;</div>
        </li>
        <li>
          Store contract ID in frontend .env
        </li>
      </ol>

      <h3>Backend Deployment</h3>
      <ul>
        <li><strong>Option 1:</strong> Heroku/Railway (free tier) - push backend/</li>
        <li><strong>Option 2:</strong> AWS Lambda + API Gateway</li>
        <li><strong>Option 3:</strong> DigitalOcean App Platform</li>
      </ul>

      <h3>Frontend Deployment</h3>
      <ul>
        <li><strong>Vercel:</strong> <code>vercel deploy</code></li>
        <li><strong>Netlify:</strong> Connect GitHub repo</li>
        <li><strong>GitHub Pages:</strong> Static build</li>
      </ul>
    </section>

    <!-- Troubleshooting -->
    <section>
      <h2>üîß Troubleshooting</h2>

      <h3>Frontend Issues</h3>
      <ul>
        <li><strong>Wallet not connecting:</strong> Install Freighter, make sure it's unlocked</li>
        <li><strong>CORS errors:</strong> Check backend is running on port 5000</li>
        <li><strong>Preview not loading:</strong> Check IPFS CID is valid</li>
      </ul>

      <h3>Backend Issues</h3>
      <ul>
        <li><strong>web3.storage upload fails:</strong> Check API token is valid</li>
        <li><strong>File too large:</strong> Increase size limit in multer config</li>
        <li><strong>Memory issues:</strong> Implement persistent database</li>
      </ul>

      <h3>Contract Issues</h3>
      <ul>
        <li><strong>Compilation fails:</strong> Update Soroban SDK to latest</li>
        <li><strong>Unauthorized errors:</strong> Check .require_auth() is called correctly</li>
        <li><strong>State not persisting:</strong> Verify storage operations</li>
      </ul>
    </section>

    <!-- Future Improvements -->
    <section>
      <h2>üöÄ Future Enhancements</h2>

      <ul>
        <li><strong>Multi-milestone jobs:</strong> Break large projects into phases</li>
        <li><strong>Dispute resolution:</strong> Arbitrator can settle conflicts</li>
        <li><strong>Reputation system:</strong> Track client/freelancer ratings</li>
        <li><strong>Token integration:</strong> Support USDC, Stellar lumens</li>
        <li><strong>Advanced encryption:</strong> Client-side encryption before upload</li>
        <li><strong>NFT certificates:</strong> Issue completion certificates</li>
        <li><strong>Mobile app:</strong> React Native version</li>
        <li><strong>Real token contracts:</strong> Full SPL/Soroban token integration</li>
      </ul>
    </section>

    <!-- Support -->
    <section>
      <h2>üìö Resources</h2>

      <h3>Documentation</h3>
      <ul>
        <li>
          <a href="https://stellar.org/developers" target="_blank">Stellar Documentation</a>
        </li>
        <li>
          <a href="https://soroban.stellar.org/" target="_blank">Soroban Smart Contracts</a>
        </li>
        <li>
          <a href="https://web3.storage/" target="_blank">web3.storage IPFS</a>
        </li>
        <li>
          <a href="https://freighter.app/" target="_blank">Freighter Wallet</a>
        </li>
      </ul>

      <h3>Community</h3>
      <ul>
        <li>Stellar Developers Discord</li>
        <li>Soroban GitHub Discussions</li>
        <li>hackathon@stellar.org for support</li>
      </ul>
    </section>

    <footer style="text-align: center; padding: 40px 0; color: #999; border-top: 1px solid #ddd;">
      <p>
        Built for Stellar Hackathon 2026 | FairDeal Escrow Platform<br/>
        <small>Use responsibly. Smart contracts are immutable once deployed.</small>
      </p>
    </footer>
  </div>
</body>
</html>
