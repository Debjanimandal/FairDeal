{"ast":null,"code":"import { Server, TransactionBuilder, Networks, Operation, Asset, Memo, BASE_FEE } from '@stellar/stellar-sdk';\nimport { signTransaction } from '@stellar/freighter-api';\n\n// Stellar testnet configuration\nconst HORIZON_URL = 'https://horizon-testnet.stellar.org';\nconst NETWORK_PASSPHRASE = Networks.TESTNET;\nconst server = new Server(HORIZON_URL);\n\n/**\r\n * Build a payment transaction from source to destination\r\n * @param sourcePublicKey - The sender's public key\r\n * @param destinationPublicKey - The recipient's public key\r\n * @param amount - Amount of XLM to send\r\n * @param memo - Optional memo text\r\n * @returns Transaction XDR string ready for signing\r\n */\nexport async function buildPaymentTransaction(sourcePublicKey, destinationPublicKey, amount, memo) {\n  try {\n    // Load the source account\n    const sourceAccount = await server.loadAccount(sourcePublicKey);\n\n    // Build the transaction\n    const transaction = new TransactionBuilder(sourceAccount, {\n      fee: BASE_FEE,\n      networkPassphrase: NETWORK_PASSPHRASE\n    }).addOperation(Operation.payment({\n      destination: destinationPublicKey,\n      asset: Asset.native(),\n      // XLM\n      amount: amount\n    })).setTimeout(180); // 3 minutes timeout\n\n    // Add memo if provided\n    if (memo) {\n      transaction.addMemo(Memo.text(memo));\n    }\n    const builtTransaction = transaction.build();\n    return builtTransaction.toXDR();\n  } catch (error) {\n    console.error('Error building transaction:', error);\n    throw new Error(`Failed to build transaction: ${error.message}`);\n  }\n}\n\n/**\r\n * Sign a transaction using Freighter wallet\r\n * @param transactionXDR - The transaction XDR to sign\r\n * @param publicKey - The public key of the signer\r\n * @returns Signed transaction XDR\r\n */\nexport async function signTransactionWithFreighter(transactionXDR, publicKey) {\n  try {\n    const {\n      signedTxXdr,\n      error\n    } = await signTransaction(transactionXDR, {\n      networkPassphrase: NETWORK_PASSPHRASE,\n      address: publicKey\n    });\n    if (error) {\n      throw new Error(error);\n    }\n    if (!signedTxXdr) {\n      throw new Error('No signed transaction returned from Freighter');\n    }\n    return signedTxXdr;\n  } catch (error) {\n    console.error('Error signing transaction:', error);\n    throw new Error(`Failed to sign transaction: ${error.message}`);\n  }\n}\n\n/**\r\n * Submit a signed transaction to the Stellar network\r\n * @param signedXDR - The signed transaction XDR\r\n * @returns Transaction result including hash\r\n */\nexport async function submitSignedTransaction(signedXDR) {\n  try {\n    const {\n      TransactionBuilder\n    } = await import('@stellar/stellar-sdk');\n    const transaction = TransactionBuilder.fromXDR(signedXDR, NETWORK_PASSPHRASE);\n    const result = await server.submitTransaction(transaction);\n    return {\n      hash: result.hash,\n      ledger: result.ledger,\n      successful: result.successful\n    };\n  } catch (error) {\n    var _error$response, _error$response$data, _error$response$data$;\n    console.error('Error submitting transaction:', error);\n\n    // Stellar-specific error handling\n    if ((_error$response = error.response) !== null && _error$response !== void 0 && (_error$response$data = _error$response.data) !== null && _error$response$data !== void 0 && (_error$response$data$ = _error$response$data.extras) !== null && _error$response$data$ !== void 0 && _error$response$data$.result_codes) {\n      const resultCodes = error.response.data.extras.result_codes;\n      throw new Error(`Transaction failed: ${resultCodes.transaction} - ${JSON.stringify(resultCodes.operations)}`);\n    }\n    throw new Error(`Failed to submit transaction: ${error.message}`);\n  }\n}\n\n/**\r\n * Complete payment flow: build, sign, and submit transaction\r\n * @param sourcePublicKey - Sender's wallet address\r\n * @param destinationPublicKey - Recipient's wallet address\r\n * @param amount - Amount of XLM\r\n * @param memo - Optional memo\r\n * @returns Transaction hash\r\n */\nexport async function executePayment(sourcePublicKey, destinationPublicKey, amount, memo) {\n  try {\n    // Step 1: Build transaction\n    console.log('Building payment transaction...');\n    const transactionXDR = await buildPaymentTransaction(sourcePublicKey, destinationPublicKey, amount, memo);\n\n    // Step 2: Sign with Freighter\n    console.log('Requesting signature from Freighter...');\n    const signedXDR = await signTransactionWithFreighter(transactionXDR, sourcePublicKey);\n\n    // Step 3: Submit to network\n    console.log('Submitting transaction to Stellar network...');\n    const result = await submitSignedTransaction(signedXDR);\n    if (!result.successful) {\n      throw new Error('Transaction was not successful');\n    }\n    console.log('Transaction successful! Hash:', result.hash);\n    return result.hash;\n  } catch (error) {\n    console.error('Payment execution failed:', error);\n    throw error;\n  }\n}\n\n/**\r\n * Verify a transaction on the Stellar network\r\n * @param transactionHash - The transaction hash to verify\r\n * @returns Transaction details if found\r\n */\nexport async function verifyTransaction(transactionHash) {\n  try {\n    const transaction = await server.transactions().transaction(transactionHash).call();\n    return transaction;\n  } catch (error) {\n    console.error('Error verifying transaction:', error);\n    throw new Error(`Failed to verify transaction: ${error.message}`);\n  }\n}","map":{"version":3,"names":["Server","TransactionBuilder","Networks","Operation","Asset","Memo","BASE_FEE","signTransaction","HORIZON_URL","NETWORK_PASSPHRASE","TESTNET","server","buildPaymentTransaction","sourcePublicKey","destinationPublicKey","amount","memo","sourceAccount","loadAccount","transaction","fee","networkPassphrase","addOperation","payment","destination","asset","native","setTimeout","addMemo","text","builtTransaction","build","toXDR","error","console","Error","message","signTransactionWithFreighter","transactionXDR","publicKey","signedTxXdr","address","submitSignedTransaction","signedXDR","fromXDR","result","submitTransaction","hash","ledger","successful","_error$response","_error$response$data","_error$response$data$","response","data","extras","result_codes","resultCodes","JSON","stringify","operations","executePayment","log","verifyTransaction","transactionHash","transactions","call"],"sources":["E:/FairDeal(stellar)/frontend/src/utils/stellar-utils.ts"],"sourcesContent":["import {\r\n    Server,\r\n    TransactionBuilder,\r\n    Networks,\r\n    Operation,\r\n    Asset,\r\n    Memo,\r\n    BASE_FEE\r\n} from '@stellar/stellar-sdk';\r\nimport { signTransaction } from '@stellar/freighter-api';\r\n\r\n// Stellar testnet configuration\r\nconst HORIZON_URL = 'https://horizon-testnet.stellar.org';\r\nconst NETWORK_PASSPHRASE = Networks.TESTNET;\r\n\r\nconst server = new Server(HORIZON_URL);\r\n\r\n/**\r\n * Build a payment transaction from source to destination\r\n * @param sourcePublicKey - The sender's public key\r\n * @param destinationPublicKey - The recipient's public key\r\n * @param amount - Amount of XLM to send\r\n * @param memo - Optional memo text\r\n * @returns Transaction XDR string ready for signing\r\n */\r\nexport async function buildPaymentTransaction(\r\n    sourcePublicKey: string,\r\n    destinationPublicKey: string,\r\n    amount: string,\r\n    memo?: string\r\n): Promise<string> {\r\n    try {\r\n        // Load the source account\r\n        const sourceAccount = await server.loadAccount(sourcePublicKey);\r\n\r\n        // Build the transaction\r\n        const transaction = new TransactionBuilder(sourceAccount, {\r\n            fee: BASE_FEE,\r\n            networkPassphrase: NETWORK_PASSPHRASE,\r\n        })\r\n            .addOperation(\r\n                Operation.payment({\r\n                    destination: destinationPublicKey,\r\n                    asset: Asset.native(), // XLM\r\n                    amount: amount,\r\n                })\r\n            )\r\n            .setTimeout(180); // 3 minutes timeout\r\n\r\n        // Add memo if provided\r\n        if (memo) {\r\n            transaction.addMemo(Memo.text(memo));\r\n        }\r\n\r\n        const builtTransaction = transaction.build();\r\n        return builtTransaction.toXDR();\r\n    } catch (error: any) {\r\n        console.error('Error building transaction:', error);\r\n        throw new Error(`Failed to build transaction: ${error.message}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Sign a transaction using Freighter wallet\r\n * @param transactionXDR - The transaction XDR to sign\r\n * @param publicKey - The public key of the signer\r\n * @returns Signed transaction XDR\r\n */\r\nexport async function signTransactionWithFreighter(\r\n    transactionXDR: string,\r\n    publicKey: string\r\n): Promise<string> {\r\n    try {\r\n        const { signedTxXdr, error } = await signTransaction(transactionXDR, {\r\n            networkPassphrase: NETWORK_PASSPHRASE,\r\n            address: publicKey,\r\n        });\r\n\r\n        if (error) {\r\n            throw new Error(error);\r\n        }\r\n\r\n        if (!signedTxXdr) {\r\n            throw new Error('No signed transaction returned from Freighter');\r\n        }\r\n\r\n        return signedTxXdr;\r\n    } catch (error: any) {\r\n        console.error('Error signing transaction:', error);\r\n        throw new Error(`Failed to sign transaction: ${error.message}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Submit a signed transaction to the Stellar network\r\n * @param signedXDR - The signed transaction XDR\r\n * @returns Transaction result including hash\r\n */\r\nexport async function submitSignedTransaction(signedXDR: string): Promise<{\r\n    hash: string;\r\n    ledger: number;\r\n    successful: boolean;\r\n}> {\r\n    try {\r\n        const { TransactionBuilder } = await import('@stellar/stellar-sdk');\r\n        const transaction = TransactionBuilder.fromXDR(signedXDR, NETWORK_PASSPHRASE);\r\n\r\n        const result = await server.submitTransaction(transaction);\r\n\r\n        return {\r\n            hash: result.hash,\r\n            ledger: result.ledger,\r\n            successful: result.successful,\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error submitting transaction:', error);\r\n\r\n        // Stellar-specific error handling\r\n        if (error.response?.data?.extras?.result_codes) {\r\n            const resultCodes = error.response.data.extras.result_codes;\r\n            throw new Error(\r\n                `Transaction failed: ${resultCodes.transaction} - ${JSON.stringify(resultCodes.operations)}`\r\n            );\r\n        }\r\n\r\n        throw new Error(`Failed to submit transaction: ${error.message}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Complete payment flow: build, sign, and submit transaction\r\n * @param sourcePublicKey - Sender's wallet address\r\n * @param destinationPublicKey - Recipient's wallet address\r\n * @param amount - Amount of XLM\r\n * @param memo - Optional memo\r\n * @returns Transaction hash\r\n */\r\nexport async function executePayment(\r\n    sourcePublicKey: string,\r\n    destinationPublicKey: string,\r\n    amount: string,\r\n    memo?: string\r\n): Promise<string> {\r\n    try {\r\n        // Step 1: Build transaction\r\n        console.log('Building payment transaction...');\r\n        const transactionXDR = await buildPaymentTransaction(\r\n            sourcePublicKey,\r\n            destinationPublicKey,\r\n            amount,\r\n            memo\r\n        );\r\n\r\n        // Step 2: Sign with Freighter\r\n        console.log('Requesting signature from Freighter...');\r\n        const signedXDR = await signTransactionWithFreighter(transactionXDR, sourcePublicKey);\r\n\r\n        // Step 3: Submit to network\r\n        console.log('Submitting transaction to Stellar network...');\r\n        const result = await submitSignedTransaction(signedXDR);\r\n\r\n        if (!result.successful) {\r\n            throw new Error('Transaction was not successful');\r\n        }\r\n\r\n        console.log('Transaction successful! Hash:', result.hash);\r\n        return result.hash;\r\n    } catch (error: any) {\r\n        console.error('Payment execution failed:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Verify a transaction on the Stellar network\r\n * @param transactionHash - The transaction hash to verify\r\n * @returns Transaction details if found\r\n */\r\nexport async function verifyTransaction(transactionHash: string): Promise<any> {\r\n    try {\r\n        const transaction = await server.transactions().transaction(transactionHash).call();\r\n        return transaction;\r\n    } catch (error: any) {\r\n        console.error('Error verifying transaction:', error);\r\n        throw new Error(`Failed to verify transaction: ${error.message}`);\r\n    }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}